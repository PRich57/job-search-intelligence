<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Listings Viewer</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
</head>
<body>
    <h1>Job Listings Viewer</h1>
    <div id="error-message" style="color: red;"></div>
    <table id="jobTable" class="display" style="width:100%">
        <thead>
            <tr>
                <th>Job Title</th>
                <th>Company</th>
                <th>Location</th>
                <th>Salary Range</th>
                <th>Source</th>
                <th>Apply</th>
            </tr>
        </thead>
    </table>

    <script>
        $(document).ready(function() {
            $('#jobTable').DataTable({
                ajax: {
                    url: '/api/jobs',
                    dataSrc: 'data',
                    error: function (xhr, error, thrown) {
                        console.error('Error:', error);
                        console.error('Response:', xhr.responseText);
                        $('#error-message').text('An error occurred while loading the data. Please try refreshing the page.');
                    }
                },
                columns: [
                    { data: 'job_title' },
                    { data: 'company_name' },
                    { data: 'job_location' },
                    { 
                        data: null,
                        render: function(data, type, row) {
                            var low = row.salary_low ? '$' + row.salary_low.toLocaleString() : 'N/A';
                            var high = row.salary_high ? '$' + row.salary_high.toLocaleString() : 'N/A';
                            return low + ' - ' + high;
                        }
                    },
                    { data: 'source' },
                    {
                        data: 'application_url',
                        render: function(data, type, row) {
                            return data ? '<a href="' + data + '" target="_blank">Apply</a>' : 'N/A';
                        }
                    }
                ],
                pageLength: 25,
                order: [[0, 'asc']],
                dom: 'lBfrtip',
                buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
            });
        });
    </script>
</body>
</html>